<!DOCTYPE html>
<html >
<head>
    <meta charset="UTF-8">
    <title>message-3</title>
    <script src="./node_modules/eventemitter/index.js"></script>



    <script src="//cdn.bootcss.com/react/0.14.7/react.min.js"></script>
    <script src="//cdn.bootcss.com/react/0.14.7/react-dom.min.js"></script>
    <script src="//cdn.bootcss.com/babel-core/5.8.24/browser.min.js"></script>

</head>
<body>

<div id="test"></div>
<script type="text/babel">

    /*
        事件总线
    */



    const eventBus=new EventEmitter();


    const Item=React.createClass({

        render(){

            let style=this.props.actived ? ({border:"solid 1px red"}):{};

            return (
                <li onClick={this.props.callback} style={style}>{this.props.name}</li>
            )
        }
    })

    const Comp=React.createClass({

        getInitialState(){
            return {
                list:[]
            }
        },

        componentWillMount(){

            let This=this;

            this.props.bus.on('test event',function(){
                console.log(This.props.name)
            })


            this.state.list=this.props.data.map(item=>{
                return {name:item,actived:false}
            })
        },

        componentDidMount(){

            setTimeout(()=>{
                this.state.list[1].actived=true;

                this.forceUpdate()
            },3000)
        },

        callback(item){
            console.log(item)
        },

        render(){
            return (
                <ul>
                    {this.state.list.map(item=>{
                        return <Item name={item.name} actived={item.actived} callback={this.callback.bind(this,item)}/>
                    })}
                </ul>
            )
        }
    })


    const list=[1,2,3,4,5,6,7];

    ReactDOM.render(
        <div>
            <Comp data={list}  bus={eventBus} name="comp one"/>
            <Comp data={list}  bus={eventBus} name="comp two"/>
        </div>
        ,document.getElementById('test'))


    setTimeout(function () {
        eventBus.emit('test event')
    },5000)



</script>

</body>
</html>